<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>SQL Server Cursor Simulation</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
:root {
    --primary:#2563eb;
    --success:#059669;
    --warning:#f59e0b;
    --error:#dc2626;
    --bg:#f8fafc;
}

body {
    font-family: Segoe UI, Tahoma, sans-serif;
    background: var(--bg);
    padding: 20px;
    color:#1e293b;
}

h2 { text-align:center; margin-bottom:5px; }
.subtitle { text-align:center; color:#64748b; margin-bottom:20px; }

.container {
    max-width:1100px;
    margin:auto;
    display:grid;
    grid-template-columns: 1fr 1fr;
    gap:20px;
}

.panel {
    background:white;
    padding:20px;
    border-radius:8px;
    box-shadow:0 4px 6px rgba(0,0,0,0.1);
}

/* Table */
table {
    width:100%;
    border-collapse:collapse;
}
th,td {
    padding:10px;
    border-bottom:1px solid #e2e8f0;
}
th {
    background:#334155;
    color:white;
}

.pointer {
    color:var(--error);
    font-weight:bold;
    visibility:hidden;
}

.active-row {
    background:#fef9c3 !important;
    border:2px solid var(--primary);
}
.active-row .pointer {
    visibility:visible;
}

/* Status */
.status-box {
    background:#0f172a;
    color:#eab308;
    padding:15px;
    border-radius:5px;
    font-family:monospace;
    margin-bottom:15px;
}

.console {
    background:#f1f5f9;
    border-left:4px solid var(--primary);
    padding:10px;
    height:160px;
    overflow-y:auto;
    font-family:monospace;
    font-size:14px;
}

/* Buttons */
button {
    background:var(--primary);
    color:white;
    border:none;
    padding:10px 18px;
    margin-right:10px;
    border-radius:5px;
    cursor:pointer;
    font-weight:bold;
}
button:disabled {
    background:#cbd5e1;
    cursor:not-allowed;
}

/* Info box */
.info {
    margin-top:15px;
    font-size:14px;
    background:#ecfeff;
    padding:12px;
    border-left:4px solid #06b6d4;
}
.highlight {
    color:var(--primary);
    font-weight:bold;
}
</style>
</head>

<body>

<h2>Working of Cursor in SQL Server</h2>
<div class="subtitle">This simulation demonstrates how an explicit cursor works in SQL Server by processing records
row by row, explaining the role of @@FETCH_STATUS and why a cursor does not return any value.</div>

<div class="container">

<!-- LEFT PANEL -->
<div class="panel">
<h3>STUDENT Table (Result Set)</h3>

<table>
<thead>
<tr>
<th>Ptr</th>
<th>ID</th>
<th>Name</th>
<th>Dept</th>
</tr>
</thead>
<tbody>
<tr id="row-0"><td><span class="pointer">➤</span></td><td>101</td><td>Raj Patel</td><td>CSE</td></tr>
<tr id="row-1"><td><span class="pointer">➤</span></td><td>102</td><td>Priya Shah</td><td>IT</td></tr>
<tr id="row-2"><td><span class="pointer">➤</span></td><td>103</td><td>Amit Kumar</td><td>CSE</td></tr>
<tr id="row-3"><td><span class="pointer">➤</span></td><td>104</td><td>Sneha Desai</td><td>ECE</td></tr>
<tr id="row-4"><td><span class="pointer">➤</span></td><td>105</td><td>Rohan Mehta</td><td>IT</td></tr>
</tbody>
</table>

<p id="pointer-msg" style="margin-top:10px;font-style:italic;color:#64748b;">
Cursor Status: NOT DECLARED
</p>
</div>

<!-- RIGHT PANEL -->
<div class="panel">

<div class="status-box">
<div>Cursor State: <span id="cursor-state">IDLE</span></div>
<div>@@FETCH_STATUS: <span id="fetch-status">N/A</span></div>
<div>Current Action: <span id="curr-action">None</span></div>
</div>

<div>
<button onclick="declareCursor()" id="btn-declare">1. DECLARE & OPEN</button>
<button onclick="fetchNext()" id="btn-fetch" disabled>2. FETCH NEXT</button>
<button onclick="closeCursor()" id="btn-close" disabled>3. CLOSE</button>
<button onclick="deallocateCursor()" id="btn-dealloc" disabled>4. DEALLOCATE</button>
</div>

<h4 style="margin-top:15px;">PRINT Output (Inside Loop)</h4>
<div class="console" id="console">-- No output yet --</div>

<div class="info">
<p><strong>Important Concept:</strong></p>
<p>
The cursor is <span class="highlight">NOT returning data</span>.
It only moves row-by-row.
</p>
<p>
The messages above are generated using
<code>PRINT</code> inside the loop,
just like in SQL Server.
</p>
</div>

</div>
</div>

<script>
let currentRow = -1;
const students = [
    {name:"Raj Patel", dept:"CSE"},
    {name:"Simran Kaur", dept:"IT"},
    {name:"Amit Shah", dept:"MECH"},
    {name:"Priya Rai", dept:"CSE"},
    {name:"John Doe", dept:"CIVIL"}
];

function clearRows(){
    document.querySelectorAll("tr").forEach(r=>r.classList.remove("active-row"));
}

function log(msg){
    const c = document.getElementById("console");
    if(c.innerHTML.includes("No output")) c.innerHTML="";
    c.innerHTML += "> " + msg + "<br>";
    c.scrollTop = c.scrollHeight;
}

function update(action,status,state){
    document.getElementById("curr-action").innerText = action;
    document.getElementById("fetch-status").innerText = status;
    document.getElementById("cursor-state").innerText = state;
}

function declareCursor(){
    currentRow = -1;
    clearRows();
    document.getElementById("pointer-msg").innerText =
        "Cursor OPENED (Pointer is BEFORE first row)";
    document.getElementById("console").innerHTML = "Cursor declared and opened.<br>";
    update("OPEN","N/A","OPENED");
    document.getElementById("btn-declare").disabled = true;
    document.getElementById("btn-fetch").disabled = false;
}

function fetchNext(){
    currentRow++;
    clearRows();

    if(currentRow < students.length){
        document.getElementById("row-"+currentRow).classList.add("active-row");
        document.getElementById("pointer-msg").innerText =
            "Cursor pointing to Row " + (currentRow+1);
        update("FETCH NEXT","0","FETCHING");
        log(students[currentRow].name + " belongs to " + students[currentRow].dept + " department.");
        document.getElementById("btn-close").disabled = false;
    } else {
        document.getElementById("pointer-msg").innerText =
            "Cursor moved PAST LAST ROW";
        update("FETCH NEXT","-1","END OF DATA");
        log("No more rows found. Loop will terminate.");
        document.getElementById("btn-fetch").disabled = true;
        document.getElementById("btn-dealloc").disabled = false;
    }
}

function closeCursor(){
    clearRows();
    update("CLOSE","N/A","CLOSED");
    document.getElementById("pointer-msg").innerText =
        "Cursor CLOSED (Result set released)";
    log("Cursor closed. Data access stopped.");
    document.getElementById("btn-close").disabled = true;
}

function deallocateCursor(){
    update("DEALLOCATE","N/A","DEALLOCATED");
    document.getElementById("pointer-msg").innerText =
        "Cursor DEALLOCATED (Memory freed)";
    log("Cursor deallocated. Memory released.");
    document.getElementById("btn-dealloc").disabled = true;
    document.getElementById("btn-declare").disabled = false;
}
</script>

</body>
</html>
